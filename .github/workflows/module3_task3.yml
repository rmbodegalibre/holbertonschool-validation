name: module3_task3

on:
  push:
    tags:
      - "1.0.0"
  schedule:
    - cron: '0 10 * * *'

permissions: read-all

jobs:
  release:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v3
      - uses: softprops/gh-release@v1
        with:
          tag_name: 1.0.0
          release_name: Release 1.0.0
      - uses: actions/upload-artifact@v2
        with:
          name: awesome-website.zip
          path: module3_task3/awesome-website.zip          
      - run: |
          DEPLOY_MD=$(cat module3_task3/DEPLOY.md)
          echo "::set-output name=deploy_md::$DEPLOY_MD"
        id: get-deploy-md
      - uses: actions/create-release-note@v1
        with:
          release_id: ${{ steps.create-release.outputs.release_id }}
          note: ${{ steps.get-deploy-md.outputs.deploy_md }}
      - run: sudo module3_task3/setup.sh
      - run: cd module3_task3 && make build
      - run: cd module3_task3 && make package
      - run: cd module3_task3 && make lint
      - run: cd module3_task3 && make unit-tests
      - run: cd module3_task3 && make integration-tests
      - run: cd module3_task3 && make validate
